<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=98c8661be0a413b412d7315735b24e96"></script>
</head>
<body>
    <table border="1" id="table">
        <thead>
            <td>약국 이름</td>
            <td>약국 위치</td>
            <td>위도</td>
            <td>경도</td>
        </thead>
        <tbody>
            
        </tbody>
    </table>
    <div id="map" style="width:500px;height:400px;"></div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
        var options = { //지도를 생성할 때 필요한 기본 옵션
	        center: new kakao.maps.LatLng(35.1394294, 126.7964119), //지도의 중심좌표.
	        level: 3 //지도의 레벨(확대, 축소 정도)
        };
        var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴
        $(document).ready(function(){
            let bplcNm = [];
            let rdnWhlAddr = [];
            let latitude = [];
            let longitude = [];
            var positions= [];
            const tbody = $('#table tbody');
            $.ajax({
            method:'get',
            url: "https://apis.data.go.kr/B551232/OAMS_PARMACY_01/GET_OAMS_PARMACY_01",
            dataType:'xml',
            data:{
                serviceKey:"ZKiieHbBwQGTkPhH0wZRgTVdfaeRSRiBaykZfbj9U9gd3PhlZ/SYdi0o32aqiLK1k4fxqf/AqUMu4n3kghRqHQ==",
                pageNo:1,
                numOfRows:10,
                STATION_NAME:"광주송정역"
            },
            
            success : function(result){
                // 데이터 확인
                console.log(result);
                let xml = $(result).find("response");
                let len = xml.find("item").length;
                for (var i = 0; i< len; i++){
                    bplcNm[i]= xml.find("item").eq(i).find("bplcNm").text();
                    rdnWhlAddr[i] = xml.find("item").eq(i).find("rdnWhlAddr").text();
                    latitude[i] = xml.find("item").eq(i).find("latitude").text();
                    longitude[i] = xml.find("item").eq(i).find("longitude").text();
                }

                for (j = 0; j<len; j++){
                    var tr = "<tr>"+
                        "<td>"+bplcNm[j]+"</td>"+
                        "<td>"+rdnWhlAddr[j]+"</td>"+
                        "<td>"+latitude[j]+"</td>"+
                        "<td>"+longitude[j]+"</td>"+
                        +"</tr>";
                    tbody.append(tr);
                    }
                
                for (k=0; k<len; k++){
                    var positioe = {
                    title:bplcNm[k],
                    lating: new kakao.maps.LatLng(latitude[k],longitude[k])
                    };
                    positions.push(positioe);
                }
                var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; 
            
                for (var e = 0; e< positions.length; e++) {
                    console.log(e)
                    // 마커 이미지의 이미지 크기 입니다
                    var imageSize = new kakao.maps.Size(24, 35); 

                    // 마커 이미지를 생성합니다    
                    var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 
                    var test;
                    // 마커를 생성합니다
                    var marker = new kakao.maps.Marker({
                        map: map, // 마커를 표시할 지도
                        position: positions[e].latlng, // 마커를 표시할 위치
                        title : positions[e].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                        image : markerImage // 마커 이미지 
                    });
                    marker.setMap(map);
                }
            },
                error: function(error){
                    console.log("erro");
                }
            })
        });
        
    </script>
</body>
</html>
